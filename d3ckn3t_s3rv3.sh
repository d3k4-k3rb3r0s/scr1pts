#!/bin/bash

# Default port number
default_port=1337
# Get hostname and IP address
hostname=$(hostname)
ip_address=$(hostname -I | awk '{print $1}')


# Function to display usage information
usage() {
clear
    #cat <<"EOF"
#
#         __       _ _____      _                    _____ _     __ 
#        | _|   __| |___ /  ___| | __          _ __ |___ /| |_  |_ |
#        | |   / _` | |_ \ / __| |/ /  _____  | '_ \  |_ \| __|  | |
#        | |  | (_| |___) | (__|   <  |_____| | | | |___) | |_   | |
#        | |   \__,_|____/ \___|_|\_\         |_| |_|____/ \__|  | |
#        |__|                                                   |__|
#                           [d3k@t3ss3r4]:[2024]
#                   __       _____            _____   __ 
#                  | _|  ___|___ / _ ____   _|___ /  |_ |
#                  | |  / __| |_ \| '__\ \ / / |_ \   | |
#                  | |  \__ \___) | |   \ V / ___) |  | |
#                  | |  |___/____/|_|    \_/ |____/   | |
#                  |__|                              |__|
#EOF

#laptop ascii
    cat <<"EOF"
|[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]|

     __       _ _____      _           _____ _                 _____            _____   __    
    | _|   __| |___ /  ___| | __ _ __ |___ /| |_           ___|___ / _ ____   _|___ /  |_ |     [d3ckn3t-s3rv3]:[v1]
    | |   / _` | |_ \ / __| |/ /| '_ \  |_ \| __|  _____  / __| |_ \| '__\ \ / / |_ \   | |     [d3k@t3ss3r4]:[2024]
    | |  | (_| |___) | (__|   < | | | |___) | |_  |_____| \__  \__) | |   \ V / ___) |  | |     [hack.the.planet]
    | |   \__,_|____/ \___|_|\_\|_| |_|____/ \__|         |___/____/|_|    \_/ |____/   | |     [all.your.nekworkz.are.belong.us]
    |__|                                                                               |__|


|[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]|
EOF
    echo -e  "\nUsage: d3ckn3t-s3rv3 [-p <port>] [-d <directory>]"
    echo -e "\nOptions:"
    echo "  -p, --port <port>       Specify the port number (default is $default_port)"
    echo "  -d, --directory <path>  Specify the directory to serve files from (default is local)"
    echo
    echo "  -h, --help              Display this usage help message."
    exit 1
}

# Function to handle keyboard interrupt
cleanup() {
clear
        #cat <<"EOF"
#
#         __       _ _____      _                    _____ _     __ 
#        | _|   __| |___ /  ___| | __          _ __ |___ /| |_  |_ |
#        | |   / _` | |_ \ / __| |/ /  _____  | '_ \  |_ \| __|  | |
#        | |  | (_| |___) | (__|   <  |_____| | | | |___) | |_   | |
#        | |   \__,_|____/ \___|_|\_\         |_| |_|____/ \__|  | |
#        |__|                                                   |__|
#                           [d3k@t3ss3r4]:[2024]
#                   __       _____            _____   __ 
#                  | _|  ___|___ / _ ____   _|___ /  |_ |
#                  | |  / __| |_ \| '__\ \ / / |_ \   | |
#                  | |  \__ \___) | |   \ V / ___) |  | |
#                  | |  |___/____/|_|    \_/ |____/   | |
#                  |__|                              |__|
#EOF

#laptop ascii
    cat <<"EOF"
|[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]|

     __       _ _____      _           _____ _                 _____            _____   __    
    | _|   __| |___ /  ___| | __ _ __ |___ /| |_           ___|___ / _ ____   _|___ /  |_ |     [d3ckn3t-s3rv3]:[v1]
    | |   / _` | |_ \ / __| |/ /| '_ \  |_ \| __|  _____  / __| |_ \| '__\ \ / / |_ \   | |     [d3k@t3ss3r4]:[2024]
    | |  | (_| |___) | (__|   < | | | |___) | |_  |_____| \__  \__) | |   \ V / ___) |  | |     [hack.the.planet]
    | |   \__,_|____/ \___|_|\_\|_| |_|____/ \__|         |___/____/|_|    \_/ |____/   | |     [all.your.nekworkz.are.belong.us]
    |__|                                                                               |__|


|[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]|
EOF
    echo -e "\n[!]:[d3ckn3t-s3rv3]:[operator interference]"
    sleep .3
    echo "[=]:[d3ckn3t-s3rv3]:[...]"
    sleep .3
    echo "[!]:[d3ckn3t-s3rv3]:[deactivating server]"
    sleep .3
    echo "[=]:[d3ckn3t-s3rv3]:[...]"
    sleep .3
    echo "[↓]:[d3ckn3t-s3rv3]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]"
    echo "[↓]:[d3ckn3t-s3rv3]:[↓]:[$hostname]:[$directory]:[server]:[$ip_address]:[$port]:[↓]"
    echo "[↓]:[d3ckn3t-s3rv3]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]"
    sleep .3
    echo "[=]:[d3ckn3t-s3rv3]:[...]"
    exit 0
}

# Set trap for keyboard interrupt (Ctrl+C)
trap cleanup SIGINT
# Parse command line options
while [[ $# -gt 0 ]]; do
    key="$1"
    case $key in
        -p|--port)
            port="$2"
            shift
            shift
            ;;
        -d|--directory)
            directory="$2"
            shift
            shift
            ;;
        *)
            usage
            ;;
    esac
done

# Set default port if not specified
if [ -z "$port" ]; then
    port=$default_port    
fi

# If directory is not specified, use the current directory
if [ -z "$directory" ]; then
    directory=$(pwd)
    fi

while [ ! -d "$directory" ]; do
sleep .5
clear
    #cat <<"EOF"
#
#         __       _ _____      _                    _____ _     __ 
#        | _|   __| |___ /  ___| | __          _ __ |___ /| |_  |_ |
#        | |   / _` | |_ \ / __| |/ /  _____  | '_ \  |_ \| __|  | |
#        | |  | (_| |___) | (__|   <  |_____| | | | |___) | |_   | |
#        | |   \__,_|____/ \___|_|\_\         |_| |_|____/ \__|  | |
#        |__|                                                   |__|
#                           [d3k@t3ss3r4]:[2024]
#                   __       _____            _____   __ 
#                  | _|  ___|___ / _ ____   _|___ /  |_ |
#                  | |  / __| |_ \| '__\ \ / / |_ \   | |
#                  | |  \__ \___) | |   \ V / ___) |  | |
#                  | |  |___/____/|_|    \_/ |____/   | |
#                  |__|                              |__|
#EOF

#laptop ascii
    cat <<"EOF"
|[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]|

     __       _ _____      _           _____ _                 _____            _____   __    
    | _|   __| |___ /  ___| | __ _ __ |___ /| |_           ___|___ / _ ____   _|___ /  |_ |     [d3ckn3t-s3rv3]:[v1]
    | |   / _` | |_ \ / __| |/ /| '_ \  |_ \| __|  _____  / __| |_ \| '__\ \ / / |_ \   | |     [d3k@t3ss3r4]:[2024]
    | |  | (_| |___) | (__|   < | | | |___) | |_  |_____| \__  \__) | |   \ V / ___) |  | |     [hack.the.planet]
    | |   \__,_|____/ \___|_|\_\|_| |_|____/ \__|         |___/____/|_|    \_/ |____/   | |     [all.your.nekworkz.are.belong.us]
    |__|                                                                               |__|


|[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]|
EOF
    sleep .5
    echo
    echo -e "\n[x]:[$hostname]:[server]:[invalid input]:[Directory $directory does not exist.]"
    sleep .5
    echo -e "[.]:[...]\n"
    echo -n "Please enter a valid directory path: "
    read directory
done

# Change to the provided directory
cd "$directory" || exit
clear
# Start the Python 3 HTTP server
    #cat <<"EOF"
#
#         __       _ _____      _                    _____ _     __ 
#        | _|   __| |___ /  ___| | __          _ __ |___ /| |_  |_ |
#        | |   / _` | |_ \ / __| |/ /  _____  | '_ \  |_ \| __|  | |
#        | |  | (_| |___) | (__|   <  |_____| | | | |___) | |_   | |
#        | |   \__,_|____/ \___|_|\_\         |_| |_|____/ \__|  | |
#        |__|                                                   |__|
#                           [d3k@t3ss3r4]:[2024]
#                   __       _____            _____   __ 
#                  | _|  ___|___ / _ ____   _|___ /  |_ |
#                  | |  / __| |_ \| '__\ \ / / |_ \   | |
#                  | |  \__ \___) | |   \ V / ___) |  | |
#                  | |  |___/____/|_|    \_/ |____/   | |
#                  |__|                              |__|
#EOF

#laptop ascii
    cat <<"EOF"
|[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]|

     __       _ _____      _           _____ _                 _____            _____   __    
    | _|   __| |___ /  ___| | __ _ __ |___ /| |_           ___|___ / _ ____   _|___ /  |_ |     [d3ckn3t-s3rv3]:[v1]
    | |   / _` | |_ \ / __| |/ /| '_ \  |_ \| __|  _____  / __| |_ \| '__\ \ / / |_ \   | |     [d3k@t3ss3r4]:[2024]
    | |  | (_| |___) | (__|   < | | | |___) | |_  |_____| \__  \__) | |   \ V / ___) |  | |     [hack.the.planet]
    | |   \__,_|____/ \___|_|\_\|_| |_|____/ \__|         |___/____/|_|    \_/ |____/   | |     [all.your.nekworkz.are.belong.us]
    |__|                                                                               |__|


|[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]:[↓]|
EOF
echo -e "\n[=]:[d3ckn3t-s3rv3]:[configuration intialized]"
sleep .3
echo "[=]:[d3ckn3t-s3rv3]:[configuring]:[hostname]:[$hostname]:"
sleep .3
echo "[=]:[d3ckn3t-s3rv3]:[configuring]:[ipv4]:[$ip_address]:"
sleep .3
echo "[=]:[d3ckn3t-s3rv3]:[configuring]:[directory]:[$directory]:"
sleep .3
echo "[=]:[d3ckn3t-s3rv3]:[configuring]:[port]:[$port]:"
sleep .3
echo "[.]:[d3ckn3t-s3rv3]:[deploying server]"
sleep .3
echo "[↑]:[d3ckn3t-s3rv3]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]"
echo "[↑]:[d3ckn3t-s3rv3]:[$hostname]:[$directory]:[server]:[$ip_address]:[$port]:[↑]"
echo "[↑]:[d3ckn3t-s3rv3]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]:[↑]"
python3 -m http.server "$port"
